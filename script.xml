<fmxmlsnippet type="FMObjectList"><Step enable="True" id="89" name="# (comment)"><Text>Modifying the following instances in a recurring series</Text></Step><Step enable="True" id="89" name="# (comment)"><Text>Part III: Change records in FM</Text></Step><Step enable="True" id="89" name="# (comment)"><Text>Mushfiq Mahmud June 2019</Text></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="1" name="Perform Script"><Calculation><![CDATA["Starting script: " & Get(ScriptName)]]></Calculation><Script id="489" name="Update Log File in T03_Lessons ( msg )"></Script></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>STEP:3 -&gt; Update all following lessons in FileMaker</Text></Step><Step enable="True" id="86" name="Set Error Capture"><Set state="True"></Set></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Get new RRULE</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::RRULE]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$rrule</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Get script Parameter</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[Get ( ScriptParameter )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$newInstanceIdsAndDatesListWithOldEventId</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Get the old event ID for finding purposes</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[JSONGetElement ( $newInstanceIdsAndDatesListWithOldEventId ; "oldEventId" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$oldEventId</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Get count of dates</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[ValueCount ( JSONListKeys ( $newInstanceIdsAndDatesListWithOldEventId; "items") )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$recurringEventCount</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Check if only one event was affected, in which case there is no need to run this script.</Text></Step><Step enable="True" id="68" name="If"><Calculation><![CDATA[$recurringEventCount â‰¤ 1]]></Calculation></Step><Step enable="True" id="103" name="Exit Script"></Step><Step enable="True" id="70" name="End If"></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Get the second from the list since the first one is already changed in the last script</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[JSONGetElement ( $newInstanceIdsAndDatesListWithOldEventId ; "items[1].date" )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$findStartDate</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Calculate new Duration</Text></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[(T03_Lessons::End_Time - T03_Lessons::Start_Time) / 3600]]></Calculation><Field table="T03_Lessons" id="4" name="Duration"></Field></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Since we are still on the affected lesson, get all lesson details from here</Text></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::id_student]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$studentId</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::id_subject]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$subjectId</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::id_tutor]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$tutorId</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::Start_Time]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$startTime</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::End_Time]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$endTime</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::Location]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$location</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::RRULE]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$rrule</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::RecurringEndingChoice]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$endingChoice</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::RecurringUntil]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$untilDate</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[T03_Lessons::originalRecurringEventData]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$originalData</Name></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Find events with the old event ID and after the find Date (included)</Text></Step><Step enable="True" id="22" name="Enter Find Mode"><Pause state="False"></Pause><Restore state="False"></Restore></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$oldEventId]]></Calculation><Field table="T03_Lessons" id="378" name="event ID"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$findStartDate & "..."]]></Calculation><Field table="T03_Lessons" id="7" name="Date"></Field></Step><Step enable="True" id="28" name="Perform Find"><Restore state="False"></Restore></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="68" name="If"><Calculation><![CDATA[Get(LastError) or Get(FoundCount) < 1]]></Calculation></Step><Step enable="True" id="87" name="Show Custom Dialog"><Title><Calculation><![CDATA["Error in script: " & Get(ScriptName)]]></Calculation></Title><Message><Calculation><![CDATA["An error occurred while attempting to delete this recurring event. The recurring event could not be deleted. Please contact your database administrator to troubleshoot."]]></Calculation></Message><Buttons><Button CommitState="True"><Calculation><![CDATA["OK"]]></Calculation></Button><Button CommitState="False"></Button><Button CommitState="False"></Button></Buttons></Step><Step enable="True" id="121" name="Close Window"><LimitToWindowsOfCurrentFile state="True"></LimitToWindowsOfCurrentFile><Window value="ByName"></Window><Name><Calculation><![CDATA["EditEventPopUp"]]></Calculation></Name></Step><Step enable="True" id="90" name="Halt Script"></Step><Step enable="True" id="70" name="End If"></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[Get ( FoundCount )]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$foundLessons</Name></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$loopIndex</Name></Step><Step enable="True" id="71" name="Loop"></Step><Step enable="True" id="72" name="Exit Loop If"><Calculation><![CDATA[$loopIndex > $foundLessons]]></Calculation></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$studentId]]></Calculation><Field table="T03_Lessons" id="184" name="id_student"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$subjectId]]></Calculation><Field table="T03_Lessons" id="326" name="id_subject"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$tutorId]]></Calculation><Field table="T03_Lessons" id="154" name="id_tutor"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$startTime]]></Calculation><Field table="T03_Lessons" id="5" name="Start_Time"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$endTime]]></Calculation><Field table="T03_Lessons" id="6" name="End_Time"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$location]]></Calculation><Field table="T03_Lessons" id="9" name="Location"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$rrule]]></Calculation><Field table="T03_Lessons" id="414" name="RRULE"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$endingChoice]]></Calculation><Field table="T03_Lessons" id="411" name="RecurringEndingChoice"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$untilDate]]></Calculation><Field table="T03_Lessons" id="413" name="RecurringUntil"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[$originalData]]></Calculation><Field table="T03_Lessons" id="417" name="originalRecurringEventData"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[// NOTE: no need to add or subtract 1 to $loopIndex, since we want the second element from the array and onwards
JSONGetElement ( $newInstanceIdsAndDatesListWithOldEventId ; "items[" & $loopIndex & "].instanceId" )]]></Calculation><Field table="T03_Lessons" id="378" name="event ID"></Field></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[List(T03_Lessons::eventIDDump; 
JSONGetElement ( $newInstanceIdsAndDatesListWithOldEventId ; "items[" & $loopIndex & "].instanceId" ))]]></Calculation><Field table="T03_Lessons" id="452" name="eventIDDump"></Field></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="16" name="Go to Record/Request/Page"><NoInteract state="False"></NoInteract><Exit state="False"></Exit><RowPageLocation value="Next"></RowPageLocation></Step><Step enable="True" id="141" name="Set Variable"><Value><Calculation><![CDATA[$loopIndex + 1]]></Calculation></Value><Repetition><Calculation><![CDATA[1]]></Calculation></Repetition><Name>$loopIndex</Name></Step><Step enable="True" id="73" name="End Loop"></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="22" name="Enter Find Mode"><Pause state="False"></Pause><Restore state="False"></Restore></Step><Step enable="True" id="76" name="Set Field"><Calculation><![CDATA[Let (
  [
    instanceId = JSONGetElement ( $newInstanceIdsAndDatesListWithOldEventId ; "items[0].instanceId" ) ;
    indexAfterInstanceId = Position ( instanceId ; "_" ; 1 ; 1 )
  ] ;
  Left ( instanceId ; indexAfterInstanceId - 1 )
)]]></Calculation><Field table="T03_Lessons" id="378" name="event ID"></Field></Step><Step enable="True" id="28" name="Perform Find"><Restore state="False"></Restore></Step><Step enable="True" id="154" name="Sort Records by Field"><SortRecordsByField value="SortAscending"></SortRecordsByField><Field table="T03_Lessons" id="7" name="Date"></Field></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="89" name="# (comment)"><Text>Go to Orignal Layout</Text></Step><Step enable="True" id="6" name="Go to Layout"><LayoutDestination value="OriginalLayout"></LayoutDestination></Step><Step enable="True" id="89" name="# (comment)"></Step><Step enable="True" id="1" name="Perform Script"><Calculation><![CDATA["Ended script: " & Get(ScriptName)]]></Calculation><Script id="489" name="Update Log File in T03_Lessons ( msg )"></Script></Step></fmxmlsnippet>